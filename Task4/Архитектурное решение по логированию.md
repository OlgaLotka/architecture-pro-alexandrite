### <a name="_b7urdng99y53"></a>**Название задачи:**  «Архитектурное решение по логированию»
### <a name="_hjk0fkfyohdk"></a>**Автор:** Лотка О.А.
### <a name="_uanumrh8zrui"></a>**Дата:** 23.08.2025 

### <a name="_u8xz25hbrgql"></a>**  Мотивация **
Добавление логирования поможет отслеживать состояние системы и поможет сопровождения выявлять проблемы
Так же это повлияет на
* скорость расследования инцидентов прома
* точное установление проблемного места
* Предотвращение проблем до того как произошел сбой

Поскольку ресурсов команды на добавление во все сервисы, необходимо начать с трасировки для создания заказов, а затем и логов для них с добавлением spanId и traceId в объект лога

### <a name="_u8xz25hbrgql"></a>**  Предлагаемое решение ** 

В первую очередь надо покрыть логами в режиме инфо все входящие запросы на создание заказов

Необходимо добавить логирование следующих событий:

* INFO - все входящие запросы и ответы
* DEBUG - время расчета модели, переходы по статусам
* ERROR - проблемы со сменой статуса (заказ не оплачен и тд), не удалось создать заказ, ошибка расчета


* Нужно создать отдельный индекс под систему
* Нужно предусмотреть маскирование всех чуствительных данных
* Нужно добавить на сообщение лога лейбл customerId
* Можно настроить поискт аномалий (во 2 очередь)

Стек Opensearch
Политики хранения логов
 * Горячая фаза (Hot, 7 дней) - данные активно пишутся
 * Тёплая фаза (Warm, 20 дней) - индекс больше не обновляется, но всё ещё запрашивается
 * Холодная фаза (Cold, до 45 дней) - Данные доступны только для чтения, запрашивается редко
 * Удаление (через 60 дней) - полное удаление


Критерии для выбора технологии


|      **Критерий**      | **OpenSearch**                          | **Elasticsearch**                                                          | **Коментарий**                                                                                         |
|:----------------------:|:----------------------------------------|:---------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------|
|        Лицензия        | Лицензия Apache 2.0                     | Elastic License                                                            | Лучше использовать продукт у которого не отзовут по политическим мотивам лицензию                       |
|        Плагины         | Можно ставить с открытом исходной кодом | Нельзя ставить любые плагины                                               | Тут в зависимости от цели, у нас нет супер строгих требований к безопасности так что плюс у OpenSearch |
|  Сложность настройки   | Сложна в настройке                      | Проще в настройке                                                          | Плюс явно у Elasticsearch                                                                              |
| Использование в облаке | Можно в разных                          | доступно на AWS, Azure и Google Cloud                                      | Если будет принято решение про облако то OpenSearch лучше                                              |
|       Стоимость        | Бесплатно                               | Базовые функции доступны бесплатно, расширенные функции — в платных планах | Плюс явно у OpenSearch                                                                                 |

### <a name="_u8xz25hbrgql"></a>**  Обеспечение безопасности **
Для обеспечения безопасности необходимо предусмотреть vpn для доступа к сети компании.
Добавить роль Сопровождение, с доступом в Opensearch и логам, так же для заведения инцидентов в внутренней сети компании поднять жиру и все проблемы решать в ней.
Выключить возможность выгрузки файлов на внешней носитель.
Папка в которой будут лежать файлы например, с отчетом или хип дампом должна быть доступна так же только сопровождению и в инциденте должна быть только ссылка на этот ресурс